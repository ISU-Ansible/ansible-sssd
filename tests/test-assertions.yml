---
- hosts: localhost
  remote_user: root

  roles:
    - role_under_test

  tasks:
    - name: "[Test] Does Configuration File Exist?"
      stat:
        path: "{{ sssd_configuration_file.filename }}"
      register: sssd_conf

    - name: "[Test] Test File Defaults"
      shell: "cat {{ sssd_configuration_file.filename }}"
      when: sssd_conf.stat.exists
      register: sssd_conf_contents

    - assert:
        that:
          - "sssd_conf_contents.rc == 0"
          - "sssd_conf_contents.stdout.find('id_provider = local')"
          - "sssd_conf_contents.stdout.find('access_provider = permit')"
